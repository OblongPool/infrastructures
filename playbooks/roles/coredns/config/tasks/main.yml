---
- name: Config DNS
  replace:
    path: /etc/systemd/resolved.conf
    regexp: '#DNS='
    replace: "DNS={{ CORE_DNS }}"
    backup: yes
  notify: Restart systemd-resolved service

- name: Config Fallback DNS
  replace:
    path: /etc/systemd/resolved.conf
    regexp: '#FallbackDNS='
    replace: "FallbackDNS={{ FALLBACK_DNS }}"
    backup: yes
  notify: Restart systemd-resolved service

- name: Update vault hosts entry
  replace:
    path: /etc/hosts
    regexp: '.* Vault Vault$'
    replace: "{{ hostvars['vault'].ansible_facts.enp0s8.ipv4.address }} Vault Vault"
    backup: yes

- name: Makesure appened vault hosts entry
  lineinfile:
    dest: /etc/hosts
    line: "{{ hostvars['vault'].ansible_facts.enp0s8.ipv4.address }} Vault Vault"
    state: present
